---
title: "Unemployment over Time"
author: "John Little"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_notebook: default
  html_document:
    df_print: paged
subtitle: An DIIG introduction to reproducible computational analysis and report writing
---

R, RStudio, and the Tidyverse are three components of a modern computational environment that leverages important characteristics of Data Science.  This tool suite is extensible but available to researchers working at various level of complexity. This example report demonstrates how computational analysis can be supported by a reproducible workflow.  You will see how RStudio and the Tidyverse are geared towards reproducibility; can render reports in various formats; aids in the important and time consuming task of data wrangling (80% of any data project); brings sophisticated visualization functions; and leverages sophisticated data management techniques.

<!-- ## Load library packages -->

```{r message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(patchwork)
```

<!-- The ggplot2 package contains an on-board dataset `economics_long` that we will use to demonstrate our computatonal workflow. -->

<!-- In these next few steps I will create various component visualizations and then patch those subparts into a single broader visualization. -->

```{r viz 1 population, include=FALSE}
plot_pop <- economics_long %>% 
  filter(variable == "pop") %>% 
  ggplot() +
  geom_line(aes(date, value, color = variable), color = "grey60") +
  scale_y_continuous(labels = scales::comma) +
  guides(color = FALSE) +
  annotate("text", x = as.Date("2002-10-01"), y = 300000, label = "Population", size = 9) +
  labs(title = "Economic Time Series",
       # subtitle = "Population",
       x = "Year", y= "") +
  theme_classic() +
  theme(plot.title.position = "plot")
plot_pop
```



```{r viz 2 unemp & consumption, include=FALSE}
variable_labels <- c("Unemployed in thousands", "Personal consumption in $Billions")

plot_facet_1 <- economics_long %>% 
  filter(variable == "pce" | variable == "unemploy") %>% 
  mutate(variable = factor(variable, levels = c("unemploy", "pce"), labels = variable_labels)) %>% 
  ggplot() +
  geom_line(aes(date, value), color = "grey60") +
  geom_line(data = . %>% filter(variable == "Unemployed in thousands"), 
            aes(date, value), size = 1.3, color = "dark orange") +
  scale_y_continuous(labels = scales::comma) +
  facet_wrap(~ variable, labeller = labeller(variable = label_wrap_gen(25))) +
  guides(color = FALSE) +
  labs(x = "", y= "") +
  theme_classic() +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        strip.text.x = element_text(size = 12))
plot_facet_1
```

```{r viz3 unemp and savings, include=FALSE}
plot_facet_2 <- economics_long %>% 
  mutate(var_label = case_when(
    variable == "pce"      ~ "Personal consumption in $Billions",
    variable == "psavert"   ~ "Personal savings rate",
    variable == "uempmed"  ~ "Median duration unemp in weeks",
    variable == "unemploy" ~ "Unemployed in thousands",
    variable == "pop"      ~ "Population"
  )) %>% 
  filter(variable == "psavert" | variable == "uempmed") %>% 
  ggplot() +
  geom_line(aes(date, value), color = "grey60") +
  scale_y_continuous(labels = scales::comma) +
  # scale_color_brewer(palette = "Dark2") +
  facet_wrap(~ var_label, labeller = labeller(var_label = label_wrap_gen(25))) +
  guides(color = FALSE) +
  labs(x = "Year", y= "",
       caption = "Source:  ggplot2::economics_long") +
  theme_classic()  +
  theme(strip.text.x = element_text(size = 12))
plot_facet_2
```


```{r bigviz composite image, echo=FALSE, fig.height=7, fig.width=12}
plot_pop + (plot_facet_1 / plot_facet_2)
```

## Explanation

This report was generated by leveraging the various [Tidyverse](https://tidyverse.org) packages listed, and briefly introduced, below.  

## dplyr

https://dplyr.tidyverse.org

Subset and sort

- `filter()` rows  [observations]
- `select()` columns [variables]
- `arrange()` arrange rows by a variable

New variables and column totals

- `mutate()` create a new variable
- `summarize()` column totals 
- `group_by()`  when used with summarize, column subtotals 

Add data from other data frames

- `left_join()`
- `anti_join()`

## tidyr

https://tidyr.tidyverse.org

- `pivot_longer()`
- `pivot_wider()`

## Visualization (**ggplot2**) & EDA

https://ggplot2.tidyverse.org
https://docs.ropensci.org/skimr

- `skimr::skim()`  - a good place to start for Exploratory Data Analysis
- `geom_histogram()`
- `geom_bar()`  (and `geom_col()`)
- `geom_boxplot()`
- `geom_line()` (time series)
- `geom_point()`


## Resources

- [This code repository](https://github.com/libjohn/presentation_diig)
- [Videos and guides](https://rfun.library.duke.edu/portfolio/r_flipped/)
- [Tidyverse documentation](https://tidyverse.org)
- [Center for Data & Visualization Sciences](https://library.duke.edu/data)

## License

https://JohnLittle.info  
[CC BY-NC](https://creativecommons.org/licenses/by-nc/4.0/)  
Creative Commons:  Attribution, Non Commercial  

